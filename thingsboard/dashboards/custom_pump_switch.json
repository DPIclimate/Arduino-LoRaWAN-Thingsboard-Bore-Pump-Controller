{
  "alias": "custom_pump_switch",
  "name": "Custom Pump Switch",
  "descriptor": {
    "type": "latest",
    "sizeX": 7.5,
    "sizeY": 3,
    "resources": [],
    "templateHtml": "<form class=\"attribute-update-form\" name=\"attrUpdateForm\"\n    ng-submit=\"updateAttribute($event)\">\n    <div style=\"padding: 0 8px; margin: auto 0;\">\n        <div class=\"attribute-update-form__grid\"\n            ng-show=\"entityDetected && isValidParameter && dataKeyDetected\">\n                <div class=\"mid\">\n                    <label class=\"rocker\">\n                        <input ng-model=\"checkboxValue\"\n                            ng-true-value=\"'true'\"\n                            ng-false-value=\"'false'\"\n                            ng-change=\"changed()\"\n                            id=\"pump-switch\"\n                            type=\"checkbox\">\n                        <span class=\"switch-left\">On</span>\n                        <span\n                            class=\"switch-right\">Off</span>\n                    </label>\n                </div>\n        </div>\n    </div>\n</form>",
    "templateCss": "html {\r\n  box-sizing: border-box;\r\n  font-family: 'Arial', sans-serif;\r\n  font-size: 100%;\r\n}\r\n*, *:before, *:after {\r\n  box-sizing: inherit;\r\n  margin:0;\r\n  padding:0;\r\n}\r\n.mid {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding-top:1em;\r\n  margin-top: -25px;\r\n}\r\n\r\n\r\n/* Switch starts here */\r\n.rocker {\r\n  display: inline-block;\r\n  position: relative;\r\n  /*\r\n  SIZE OF SWITCH\r\n  ==============\r\n  All sizes are in em - therefore\r\n  changing the font-size here\r\n  will change the size of the switch.\r\n  See .rocker-small below as example.\r\n  */\r\n  font-size: 2em;\r\n  font-weight: bold;\r\n  text-align: center;\r\n  text-transform: uppercase;\r\n  color: #888;\r\n  width: 7em;\r\n  height: 4em;\r\n  overflow: hidden;\r\n  border-bottom: 0.5em solid #eee;\r\n}\r\n\r\n.rocker-small {\r\n  font-size: 0.75em; /* Sizes the switch */\r\n  margin: 1em;\r\n}\r\n\r\n.rocker::before {\r\n  content: \"\";\r\n  position: absolute;\r\n  top: 0.5em;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: #999;\r\n  border: 0.5em solid #eee;\r\n  border-bottom: 0;\r\n}\r\n\r\n.rocker input {\r\n  opacity: 0;\r\n  width: 0;\r\n  height: 0;\r\n}\r\n\r\n.switch-left,\r\n.switch-right {\r\n  cursor: pointer;\r\n  position: absolute;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 2.5em;\r\n  width: 3em;\r\n  transition: 0.2s;\r\n}\r\n\r\n.switch-left {\r\n  height: 2.4em;\r\n  width: 2.75em;\r\n  left: 0.85em;\r\n  bottom: 0.4em;\r\n  background-color: #ddd;\r\n  transform: rotate(15deg) skewX(15deg);\r\n}\r\n\r\n.switch-right {\r\n  right: 0.5em;\r\n  bottom: 0;\r\n  background-color: #bd5757;\r\n  color: #fff;\r\n}\r\n\r\n.switch-left::before,\r\n.switch-right::before {\r\n  content: \"\";\r\n  position: absolute;\r\n  width: 0.4em;\r\n  height: 2.45em;\r\n  bottom: -0.45em;\r\n  background-color: #ccc;\r\n  transform: skewY(-65deg);\r\n}\r\n\r\n.switch-left::before {\r\n  left: -0.4em;\r\n}\r\n\r\n.switch-right::before {\r\n  right: -0.375em;\r\n  background-color: transparent;\r\n  transform: skewY(65deg);\r\n}\r\n\r\ninput:checked + .switch-left {\r\n  background-color: #0084d0;\r\n  color: #fff;\r\n  bottom: 0px;\r\n  left: 0.5em;\r\n  height: 2.5em;\r\n  width: 3em;\r\n  transform: rotate(0deg) skewX(0deg);\r\n}\r\n\r\ninput:checked + .switch-left::before {\r\n  background-color: transparent;\r\n  width: 3.0833em;\r\n}\r\n\r\ninput:checked + .switch-left + .switch-right {\r\n  background-color: #ddd;\r\n  color: #888;\r\n  bottom: 0.4em;\r\n  right: 0.8em;\r\n  height: 2.4em;\r\n  width: 2.75em;\r\n  transform: rotate(-15deg) skewX(-15deg);\r\n}\r\n\r\ninput:checked + .switch-left + .switch-right::before {\r\n  background-color: #ccc;\r\n}\r\n\r\n/* Keyboard Users */\r\ninput:focus + .switch-left {\r\n  color: #333;\r\n}\r\n\r\ninput:checked:focus + .switch-left {\r\n  color: #fff;\r\n}\r\n\r\ninput:focus + .switch-left + .switch-right {\r\n  color: #fff;\r\n}\r\n\r\ninput:checked:focus + .switch-left + .switch-right {\r\n  color: #333;\r\n}",
    "controllerScript": "let $scope;\nlet settings;\nlet attributeService;\nlet toast;\nlet utils;\nlet types;\nlet $translate;\nlet map;\nlet mapReverse;\n\nself.onInit = function() {\n    $scope = self.ctx.$scope;\n    attributeService = $scope.$injector.get('attributeService');\n    utils = $scope.$injector.get('utils');\n    types = $scope.$injector.get('types');\n    $translate = $scope.$injector.get('$translate');\n    settings = angular.copy(self.ctx.settings) || {};\n    $scope.settings = settings;\n    $scope.isValidParameter = true;\n    $scope.dataKeyDetected = false;\n\n    settings.trueValue = utils.customTranslation(settings.trueValue, settings.trueValue) || true;\n    settings.falseValue = utils.customTranslation(settings.falseValue, settings.falseValue) || false;\n\n    map = {\"true\":settings.trueValue, \"false\": settings.falseValue};\n    mapReverse = {[settings.trueValue]:true, [settings.falseValue]:false};\n    $scope.checkboxValue = \"false\";\n    $scope.currentValue = map[$scope.checkboxValue];\n\n    $scope.changed = function () {\n        $scope.currentValue = map[$scope.checkboxValue];\n        $scope.updateAttribute();\n    }\n\n    if (self.ctx.datasources && self.ctx.datasources.length) {\n        var datasource = self.ctx.datasources[0];\n        if (datasource.type === types.datasourceType.entity) {\n            if (datasource.entityType && datasource.entityId) {\n                $scope.entityName = datasource.entityName;\n                if (settings.widgetTitle && settings.widgetTitle.length) {\n                    $scope.titleTemplate = utils.customTranslation(settings.widgetTitle, settings.widgetTitle);\n                } else {\n                    $scope.titleTemplate = self.ctx.widgetConfig.title;\n                }\n\n                $scope.entityDetected = true;\n            }\n        }\n        if (datasource.dataKeys.length) {\n            if (datasource.dataKeys[0].type != types.dataKeyType.attribute) {\n                $scope.isValidParameter = false;\n            } else {\n                $scope.currentKey = datasource.dataKeys[0].name;\n                $scope.dataKeyType = datasource.dataKeys[0].type;\n                $scope.dataKeyDetected = true;\n            }\n        }\n    }\n\n    self.ctx.widgetTitle = utils.createLabelFromDatasource(self.ctx.datasources[0], $scope.titleTemplate);\n\n    $scope.updateAttribute = function () {\n        if ($scope.entityDetected) {\n            var datasource = self.ctx.datasources[0];\n\n            attributeService.saveEntityAttributes(\n                datasource.entityType,\n                datasource.entityId,\n                types.attributesScope.server.value,\n                [\n                    {\n                        key: $scope.currentKey,\n                        value: mapReverse[$scope.currentValue] || false\n                    }\n                ]\n            ).then(\n                function success() {\n                    $scope.originalValue = $scope.currentValue;\n                    if (settings.showResultMessage) {\n                        toast.showSuccess($translate.instant('widgets.input-widgets.update-successful'), 1000, angular.element(self.ctx.$container), 'bottom left');\n                    }\n                },\n                function fail() {\n                    if (settings.showResultMessage) {\n                        toast.showError($translate.instant('widgets.input-widgets.update-failed'), angular.element(self.ctx.$container), 'bottom left');\n                    }\n                }\n            );\n        }\n    };\n}\n\nself.onDataUpdated = function() {\n    try {\n        if ($scope.dataKeyDetected) {\n            $scope.checkboxValue = ($scope.originalValue = self.ctx.data[0].data[0][1]) || false;\n            document.getElementById(\"timer-type\").disabled = (self.ctx.data[0].data[0][1] == \"true\");\n           document.getElementById(\"custom-timer-input\").disabled = (self.ctx.data[0].data[0][1] == \"true\");\n            custom-timer-input\n            $scope.currentValue = map[$scope.checkboxValue];\n            $scope.$digest();\n        }\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        maxDataKeys: 1\n    }\n}\n\nself.onResize = function() {}\nself.onDestroy = function() {}\n",
    "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"EntitiesTableSettings\",\n        \"properties\": {\n            \"widgetTitle\": {\n                \"title\": \"Widget title\",\n                \"type\": \"string\",\n                \"default\": \"\"\n            },\n            \"trueValue\": {\n                \"title\": \"True value\",\n                \"type\": \"string\",\n                \"default\": \"\"\n            },\n            \"falseValue\": {\n                \"title\": \"False value\",\n                \"type\": \"string\",\n                \"default\": \"\"\n            },\n            \"showResultMessage\":{\n                \"title\":\"Show result message\",\n                \"type\":\"boolean\",\n                \"default\":true\n            }\n        },\n        \"required\": []\n    },\n    \"form\": [\n        \"widgetTitle\",\n        \"showResultMessage\",\n        \"trueValue\",\n        \"falseValue\"\n    ]\n}",
    "dataKeySettingsSchema": "{}\n",
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Custom Pump Switch\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"useDashboardTimewindow\":true,\"showLegend\":false,\"actions\":{}}"
  }
}